<div class="form-card-1 animate-fade-in">
  <form class="w-100">

    <div class="section-header">
      <h5>Relevant Details</h5>
      <button id="TP_RD_Save" type="submit" class="btn-fill btn-f-3" (click)="saveData()">Save Changes</button>
    </div>

    <div class="row g-4 form-wrapper">
      <!-- Skills Section -->
      <div class="col-12">
        <div class="form-group skills-container">
          <label for="skills">Key Skills Covered <span>(press enter to add)</span></label>
          <div class="tags-input">
            <span class="tag" *ngFor="let skill of relevantDetails.skills">
              {{ skill }}
              <span class="remove-tag" (click)="removeSkill(skill)">√ó</span>
            </span>
            <input type="text" id="skills" [(ngModel)]="inputValue" [ngModelOptions]="{standalone: true}"
              (keydown)="addSkill($event)" placeholder="E.g. Advanced SQL, Optimization..." />
          </div>
        </div>
      </div>

      <!-- Timezone and Date -->
      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="timezone">Preferred Timezone *</label>
          <select [(ngModel)]="trainerTimezone" class="form-control" id="timezone"
            [ngModelOptions]="{standalone: true}">
            <option *ngFor="let tz of timezones" [value]="tz">{{ tz }}</option>
          </select>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="startDate">Course Start Date *</label>
          <input type="date" class="form-control" id="startDate" [(ngModel)]="relevantDetails.startDate"
            [ngModelOptions]="{standalone: true}" required>
        </div>
      </div>

      <!-- Time Range -->
      <div class="col-6 col-md-3">
        <div class="form-group">
          <label for="startTime">Daily Start *</label>
          <input type="time" class="form-control" id="startTime" [(ngModel)]="relevantDetails.startTime" required
            [ngModelOptions]="{standalone: true}">
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="form-group">
          <label for="endTime">Daily End *</label>
          <input type="time" class="form-control" id="endTime" [(ngModel)]="relevantDetails.endTime" required
            [ngModelOptions]="{standalone: true}">
        </div>
      </div>

      <!-- Banner Upload -->
      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="banner">Cover Image Banner</label>
          <div class="d-flex gap-2">
            <input type="file" class="form-control" id="banner" (change)="onFileChange($event)" accept="image/*">
            <button type="button" class="btn-outline btn-o-1 px-4" (click)="downloadSampleBanner()">Preview
              Sample</button>
          </div>
          <span class="error-msg">Recommended: 1280x720px (16:9 ratio) for best display.</span>
        </div>
      </div>

      <!-- Free/Paid Toggle -->
      <div class="col-12">
        <div class="form-check animate-pulse-subtle">
          <input class="form-check-input" type="checkbox" id="freeCheck" [(ngModel)]="relevantDetails.freeCheck"
            [ngModelOptions]="{standalone: true}" (change)="onFreeCheckChange()">
          <label class="form-check-label" for="freeCheck">Mark this course as completely free</label>
        </div>
      </div>

      <!-- Pricing Logic -->
      <div class="col-6 col-md-3">
        <div class="form-group">
          <label for="currency">Currency *</label>
          <select class="form-control" id="currency" [(ngModel)]="selectedCurrency"
            [ngModelOptions]="{standalone: true}" required [disabled]="relevantDetails.freeCheck">
            <option value="$">USD - United States Dollar</option>
            <option value="Rs">LKR - Sri Lankan Rupee</option>
            <option value="‚Çπ">INR - Indian Rupee</option>
            <option value="‚Ç¨">EUR - Euro</option>
          </select>
        </div>
      </div>

      <div class="col-6 col-md-3">
        <div class="form-group">
          <label for="price">Price Amount *</label>
          <input type="text" class="form-control" id="price" placeholder="0.00" [(ngModel)]="selectedPrice"
            [ngModelOptions]="{standalone: true}" required [disabled]="relevantDetails.freeCheck">
        </div>
      </div>

      <!-- Delivery and Category -->
      <div class="col-12 col-md-6" [ngClass]="{'col-lg-3': relevantDetails.mediaType === 'physical'}">
        <div class="form-group">
          <label for="mediaType">Delivery Method *</label>
          <select class="form-control" id="mediaType" [(ngModel)]="relevantDetails.mediaType"
            [ngModelOptions]="{standalone: true}" required>
            <option value="zoom">Zoom Video Call</option>
            <option value="meet">Google Meet</option>
            <option value="team">Microsoft Teams</option>
            <option value="online">Other Online Platform</option>
            <option value="physical">Physical Location</option>
          </select>
        </div>
      </div>

      <div class="col-12" [ngClass]="{'col-lg-3': relevantDetails.mediaType === 'physical'}"
        *ngIf="relevantDetails.mediaType === 'physical'">
        <div class="form-group">
          <label for="location">Maps Location URL</label>
          <input type="text" class="form-control" id="location" placeholder="https://maps.google.com/..."
            [(ngModel)]="relevantDetails.location" [ngModelOptions]="{standalone: true}">
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="category">Course Category</label>
          <div class="input-group dropup-center dropup position-relative">
            <input type="text" class="form-control" id="category" [(ngModel)]="relevantDetails.category"
              [ngModelOptions]="{standalone: true}" (input)="filterCategories()" placeholder="Search or add category..."
              autocomplete="off" />

            <div *ngIf="filteredCategories.length > 0 && relevantDetails.category" class="dropdown-menu show w-100"
              style="max-height: 200px; overflow-y: auto;">
              <button *ngFor="let category of filteredCategories" class="dropdown-item"
                (click)="selectCategory(category)">
                {{ category }}
              </button>

              <button *ngIf="!filteredCategories.includes(relevantDetails.category) && relevantDetails.category"
                class="dropdown-item text-primary fw-bold" (click)="addCategory()">
                + Create New: "{{ relevantDetails.category }}"
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-6">
        <div class="form-group">
          <label for="status">Publication Status *</label>
          <select class="form-control" id="status" [(ngModel)]="relevantDetails.courseStatus"
            [ngModelOptions]="{standalone: true}" required>
            <option value="upcoming">üöÄ Upcoming</option>
            <option value="ongoing">üî• Ongoing</option>
            <option value="completed">‚úÖ Completed</option>
            <option value="cancelled">‚ùå Cancelled</option>
          </select>
        </div>
      </div>
    </div>
  </form>

  <!-- Modal and Hidden trigger -->
  <button #triggerModal type="button" class="d-none" data-bs-toggle="modal"
    data-bs-target="#imageCropperModal"></button>

  <div class="modal fade" id="imageCropperModal" tabindex="-1" aria-labelledby="cropperLabel" aria-hidden="true"
    data-bs-backdrop="static">
    <div class="modal-dialog modal-md modal-dialog-centered">
      <div class="modal-content shadow-premium">
        <div class="modal-header">
          <h5 class="modal-title" id="cropperLabel">Adjust Cover Image</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
            (click)="cancelCrop()"></button>
        </div>
        <div class="modal-body">
          <image-cropper [imageChangedEvent]="imageChangedEvent" [maintainAspectRatio]="true" [aspectRatio]="16 / 9"
            [resizeToWidth]="1280" format="png" (imageCropped)="imageCropped($event)">
          </image-cropper>
        </div>
        <div class="modal-footer">
          <button #cancelCropBtn type="button" class="btn btn-outline-secondary rounded-pill px-4"
            data-bs-dismiss="modal" (click)="cancelCrop()">Cancel</button>
          <button class="btn btn-primary rounded-pill px-4" (click)="uploadCroppedImage()" [disabled]="loading">
            <span *ngIf="!loading">Apply & Upload</span>
            <span *ngIf="loading">Processing...</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>